# Hour Jungle EIP 系統完整藍圖

## 系統架構總覽

```
┌─────────────────────────────────────────────────────────────────┐
│                     Hour Jungle Brain (AI 中樞)                  │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │  全通路訊息管理 │ 任務調度 │ 自動化引擎 │ 學習系統        │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
        │           │           │           │           │
        ▼           ▼           ▼           ▼           ▼
┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
│ 客戶    │ │ 空間    │ │ 財務    │ │ 人資    │ │ 營運    │
│ 管理    │ │ 管理    │ │ 管理    │ │ 管理    │ │ 管理    │
└────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘ └────┬────┘
     │           │           │           │           │
     ▼           ▼           ▼           ▼           ▼
```

---

## 模組 1：客戶管理 (CRM) ✅ 已有 85%

### 現有功能
- [x] 客戶資料管理
- [x] 合約管理
- [x] 繳費紀錄
- [x] LINE Bot 整合
- [x] 發票 OCR

### 待補功能
- [ ] **線上合約簽署**（串接點簽、Adobe Sign）
- [ ] **逾期自動催繳**（LINE 推播 + Email）
- [ ] **存證信函自動產生**（逾期 > 30天觸發）
- [ ] 自動續約提醒（到期前 60/30/7 天）
- [ ] 客戶滿意度調查自動發送

### 自動化流程
```
合約到期前 60 天 → LINE 推播續約提醒
合約到期前 30 天 → Email + LINE 雙推
合約到期前 7 天  → 電話提醒（派工給員工）
逾期 7 天        → 第一次催繳 LINE
逾期 14 天       → 第二次催繳 + Email
逾期 30 天       → 自動產生存證信函草稿 → 人工審核 → 發送
```

---

## 模組 2：空間管理 🆕

### 承租戶管理
- [ ] 入駐 Checklist（自動產生待辦）
- [ ] 退租 Checklist（押金退還、設備點交）
- [ ] 鑰匙/門禁卡管理
- [ ] 座位/辦公室分配圖

### 硬體設備管理
- [ ] 設備清單（冷氣、網路、印表機...）
- [ ] **維修派工單系統**
  - 報修管道：LINE Bot / Dashboard
  - 自動派工給維修人員
  - 進度追蹤 + 完工通知
  - 維修歷史記錄
- [ ] 定期保養排程（冷氣清洗、消防檢查...）

### 會議室預約
- [ ] 線上預約系統
- [ ] Google Calendar 同步
- [ ] 自動提醒（預約前 30 分鐘）
- [ ] 超時自動計費

---

## 模組 3：財務管理 💰

### 收款管理
- [ ] **金流整合**（統一金流 / 藍新）
- [ ] 自動對帳（銀行匯款 vs 系統紀錄）
- [ ] 發票自動開立（串接電子發票）
- [ ] 應收帳款報表

### 支出管理
- [ ] 採購申請 → 審核 → 付款
- [ ] **水電費電子帳單自動擷取**
- [ ] 費用分攤（公共區域電費分攤）
- [ ] 供應商管理

### 報表
- [ ] 每日營收 Dashboard
- [ ] 月度損益報表
- [ ] 現金流預測

---

## 模組 4：人資管理（2025年1月整合）👥

### 排班系統
- [ ] 排班表管理
- [ ] 班表衝突檢查
- [ ] 加班自動計算

### 打卡系統
- [ ] 多種打卡方式（APP / 門禁 / 網頁）
- [ ] GPS 定位（外勤）
- [ ] 異常打卡提醒

### 薪資計算
- [ ] 勞基法合規計算
- [ ] 加班費自動計算
- [ ] 勞健保代扣
- [ ] 薪資條自動發送

### API 整合點
- 打卡紀錄 → Brain
- 排班資料 → 任務派工參考
- 薪資發放 → 財務模組

---

## 模組 5：全通路訊息管理（Brain 核心）🧠

### 輸入管道
- [ ] LINE@ Webhook
- [ ] LINE 個人（手動貼入）
- [ ] Email（IMAP 自動擷取）
- [ ] 電話（Twilio + Whisper）
- [ ] 網站表單

### AI 處理
- [ ] 意圖分類（Router）
- [ ] 草稿生成（多版本）
- [ ] 策略建議（SPIN 銷售）
- [ ] RAG 知識庫檢索

### 人工審核
- [ ] 統一收件匣 Dashboard
- [ ] 草稿選擇/編輯
- [ ] 一鍵發送

### 學習機制
- [ ] 修改記錄 + Diff 分析
- [ ] AI 分析修改原因
- [ ] 動態 Prompt 優化
- [ ] 成功案例自動加入 RAG

---

## 模組 6：任務與工作流 📋

### 任務管理
- [ ] 待辦事項清單
- [ ] 任務指派 + 到期日
- [ ] 優先級排序
- [ ] 完成度追蹤

### 自動化工作流
- [ ] 觸發條件設定（時間 / 事件 / 數據）
- [ ] 動作執行（通知 / 建立任務 / API 呼叫）
- [ ] 審核節點（需人工確認）
- [ ] 執行記錄

### 通知中心
- [ ] 統一通知收件匣
- [ ] 通知優先級
- [ ] 已讀/未讀管理
- [ ] 多管道推播（LINE / Email / Dashboard）

---

## 整合流程範例

### 範例 1：新客戶入駐全流程
```
GA 廣告點擊
    ↓
Landing Page → LINE 加好友
    ↓
AI 自動問診（SPIN）→ 人工審核回覆
    ↓
預約參觀 → Google Calendar 同步
    ↓
現場導覽 → CRM 更新狀態
    ↓
報價單產生 → 客戶確認
    ↓
線上合約簽署 → 自動建立客戶檔案
    ↓
收款通知 → 金流收款 → 自動對帳
    ↓
入駐 Checklist 自動產生
    ↓
歡迎訊息自動發送
```

### 範例 2：硬體維修流程
```
承租戶報修（LINE Bot：「冷氣壞了」）
    ↓
AI 分類 → 維修派工單自動建立
    ↓
派工給維修人員（LINE 通知）
    ↓
維修人員接單 → 狀態更新
    ↓
維修完成 → 拍照上傳
    ↓
承租戶確認 → 滿意度調查
    ↓
記錄歸檔（設備維修歷史）
```

### 範例 3：逾期催繳流程
```
繳費到期日
    ↓
D+1：系統檢查未繳款
    ↓
D+3：LINE 溫馨提醒
    ↓
D+7：Email + LINE 正式催繳
    ↓
D+14：電話催繳（派工給員工）
    ↓
D+30：存證信函草稿自動產生 → 人工審核
    ↓
確認發送 → 記錄存檔
```

---

## 技術架構

```
┌─────────────── Frontend ───────────────┐
│  React (現有) + Dashboard 擴充          │
│  Mobile: React Native 或 PWA           │
└────────────────────┬───────────────────┘
                     │
┌────────────────────┴───────────────────┐
│              API Gateway               │
│         (認證、流量控制、日誌)          │
└────────────────────┬───────────────────┘
          ┌──────────┴──────────┐
          ▼                     ▼
┌──────────────────┐  ┌──────────────────┐
│  Laravel 後端    │  │  Python Brain    │
│  (現有 CRM)      │  │  (AI 中樞)       │
│  • 客戶管理      │  │  • 訊息處理      │
│  • 合約管理      │  │  • 草稿生成      │
│  • 財務管理      │  │  • 學習引擎      │
│  • 排程任務      │  │  • RAG 知識庫    │
└────────┬─────────┘  └────────┬─────────┘
         │                     │
         └──────────┬──────────┘
                    ▼
┌─────────────── Database ───────────────┐
│  PostgreSQL (主資料庫)                  │
│  + pgvector (向量搜尋)                  │
│  + Redis (快取、佇列)                   │
└─────────────────────────────────────────┘
                    │
┌───────────────────┴────────────────────┐
│           外部服務整合                  │
├─────────────────────────────────────────┤
│ • LINE Messaging API                   │
│ • Twilio (電話)                        │
│ • 統一金流 / 藍新                       │
│ • 點簽 / Adobe Sign (電子簽章)          │
│ • Google Calendar API                  │
│ • Claude API                           │
│ • Whisper API                          │
│ • Google Vision (發票 OCR)             │
└─────────────────────────────────────────┘
```

---

## 開發優先級建議

### 🔴 Phase 1：止血（1-2 週）
讓你每天少救火 2 小時

1. 全通路訊息管理 MVP
2. 硬體維修派工單
3. 自動續約提醒

### 🟡 Phase 2：建立系統（3-4 週）
讓員工能接手更多事

4. 線上合約簽署
5. 金流整合 + 自動對帳
6. 逾期催繳自動化

### 🟢 Phase 3：優化（5-8 週）
讓 AI 越來越聰明

7. 學習引擎完善
8. 報表 Dashboard
9. 水電費自動擷取

### 🔵 Phase 4：整合（2025年1月後）
完整 EIP

10. 薪資排班系統 API 整合
11. 完整工作流引擎
12. Mobile App
